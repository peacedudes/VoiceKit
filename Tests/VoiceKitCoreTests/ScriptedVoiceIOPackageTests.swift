//
//  ScriptedVoiceIOPackageTests.swift
//  VoiceKit
//
//  Created by robert on 9/12/25.
//


//
//  ScriptedVoiceIOPackageTests.swift
//  VoiceKitCoreTests
//
//  Generated by GPT-5 (OpenAI) â€” collaborator: rdoggett
//  date: 09-12-2025
//

import XCTest
import VoiceKitCore

@MainActor
final class ScriptedVoiceIOPackageTests: XCTestCase {

    private func b64(_ array: [String]) -> String {
        let data = try! JSONSerialization.data(withJSONObject: array, options: [])
        return data.base64EncodedString()
    }

    func testInitFromBase64() {
        XCTAssertNotNil(ScriptedVoiceIO(fromBase64: b64(["hello"])))
        XCTAssertNil(ScriptedVoiceIO(fromBase64: "not-base64"))
    }

    func testListenDequeuesFirstPhrase() async throws {
        guard let io = ScriptedVoiceIO(fromBase64: b64(["alpha", "beta"])) else {
            XCTFail("Failed to construct ScriptedVoiceIO")
            return
        }
        let r1 = try await io.listen(timeout: 1.5, inactivity: 0.4, record: false)
        XCTAssertEqual(r1.transcript, "alpha")
        let r2 = try await io.listen(timeout: 1.5, inactivity: 0.4, record: false)
        XCTAssertEqual(r2.transcript, "beta")
    }
}