//
//  NameMatchTests.swift
//  VoiceKit
//
//  Generated by GPT-5 (OpenAI) — collaborator: rdoggett
//  date: 09-12-2025
//

import XCTest
import VoiceKitCore

final class NameMatchTests: XCTestCase {

    func testNormalizeKeyHandlesDiacriticsLigaturesApostrophes() {
        // Zoë O’Connor → "zoe oconnor"
        let s = "Zoë O’Connor"
        let norm = NameMatch.normalizeKey(s)
        XCTAssertEqual(norm, "zoe oconnor")

        // Æthelred → "aethelred"
        XCTAssertEqual(NameMatch.normalizeKey("Æthelred"), "aethelred")

        // Mixed punctuation collapses and lowercases
        XCTAssertEqual(NameMatch.normalizeKey("  Jean‑Luc  Picard! "), "jean-luc picard")
    }

    func testStringDistanceScoreTokenAware() {
        // Close spellings should be < 0.35
        let a = NameMatch.normalizeKey("Katherine")
        let b = NameMatch.normalizeKey("Catherine")
        let score = NameMatch.stringDistanceScore(a: a, b: b)
        XCTAssertLessThan(score, 0.35)

        // Different names should be larger
        let c = NameMatch.normalizeKey("Bob")
        let d = NameMatch.normalizeKey("Alice")
        let score2 = NameMatch.stringDistanceScore(a: c, b: d)
        XCTAssertGreaterThan(score2, 0.35)
    }
}
