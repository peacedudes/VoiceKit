//
//  VoiceProfilesStoreBootstrapTests.swift
//  VoiceKit
//
//  Created by robert on 9/14/25.
//


//
//  VoiceProfilesStoreBootstrapTests.swift
//  VoiceKitUITests
//
//  Generated by GPT-5 (OpenAI) â€” collaborator: rdoggett
//  date: 09-14-2025
//

import XCTest
import VoiceKitCore
import VoiceKitUI

@MainActor
final class VoiceProfilesStoreBootstrapTests: XCTestCase {

    func testProfileForCreatesAndPersists() {
        let filename = "bootstrap-\(UUID().uuidString).json"
        let store1 = VoiceProfilesStore(filename: filename)
        let voiceInfo = TTSVoiceInfo(id: "v.bootstrap", name: "Bootstrap Voice", language: "en-US")

        // First access creates a default profile
        var profile = store1.profile(for: voiceInfo)
        XCTAssertEqual(profile.displayName, "Bootstrap Voice")
        profile.displayName = "Custom Name"
        profile.rate = 0.62
        profile.pitch = 1.15
        profile.volume = 0.75
        store1.setProfile(profile)
        store1.toggleActive(voiceInfo.id)
        store1.setHidden(voiceInfo.id, true)
        store1.save()

        // Reload and verify
        let store2 = VoiceProfilesStore(filename: filename)
        guard let loaded = store2.profilesByID[voiceInfo.id] else {
            return XCTFail("Profile did not persist")
        }
        XCTAssertEqual(loaded.displayName, "Custom Name")
        XCTAssertEqual(loaded.rate, 0.62 as Float, accuracy: 0.0001 as Float)
        XCTAssertEqual(loaded.pitch, 1.15 as Float, accuracy: 0.0001 as Float)
        XCTAssertEqual(loaded.volume, 0.75 as Float, accuracy: 0.0001 as Float)
        XCTAssertTrue(store2.isActive(voiceInfo.id))
        XCTAssertTrue(store2.isHidden(voiceInfo.id))
    }
}