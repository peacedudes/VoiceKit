//
//  ScriptedVoiceIOPackageTests.swift
//  VoiceKit
//
//  Generated by GPT-5 (OpenAI) - collaborator: rdoggett
//  date: 09-14-2025
//

import XCTest
import VoiceKit

@MainActor
internal final class ScriptedVoiceIOPackageTests: XCTestCase {

    private func base64(of strings: [String]) -> String {
        let data = (try? JSONSerialization.data(withJSONObject: strings, options: [])) ?? Data()
        return data.base64EncodedString()
    }

    func testInitFromBase64() {
        XCTAssertNotNil(ScriptedVoiceIO(fromBase64: base64(of: ["hello"])))
        XCTAssertNil(ScriptedVoiceIO(fromBase64: "not-base64"))
    }

    func testListenDequeuesInOrder() async throws {
        guard let voice = ScriptedVoiceIO(fromBase64: base64(of: ["alpha", "beta"])) else {
            return XCTFail("Failed to construct ScriptedVoiceIO")
        }
        let firstResult = try await voice.listen(timeout: 1.5, inactivity: 0.4, record: false)
        XCTAssertEqual(firstResult.transcript, "alpha")
        let secondResult = try await voice.listen(timeout: 1.5, inactivity: 0.4, record: false)
        XCTAssertEqual(secondResult.transcript, "beta")
    }
}
